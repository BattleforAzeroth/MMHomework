import pandas as pd
import numpy as np
import matplotlib.pyplot as plt


# 读取能耗品种结构数据
# 数据来自《经济与能源》22-70行
def read_structure_of_consumption(file):
    sheet = '经济与能源'
    df = pd.read_excel(file, sheet_name=sheet)
    return df.values[22:28, 5:16], df.values[28:34, 5:16], df.values[46:52, 5:16], df.values[64:70, 5:16]


# 能耗品种结构图表绘制
# 数据来自《经济与能源》22-70行
def plot_structure_of_consumption(consumption, name):
    x = range(2010, 2021)
    labels = ['煤炭', '油品', '天然气', '热力', '电力', '其他能源']
    sum = np.zeros((1, len(x))).reshape(-1)
    for i in range(len(labels)):
        plt.bar(x, consumption[i], label=labels[i], alpha=0.2, bottom=sum, width=0.5)
    plt.xlabel('年份')
    plt.ylabel('消耗量（万tce）')
    plt.gca().xaxis.set_major_locator(plt.MultipleLocator(1))  # x轴刻度间隔设为1
    plt.title(name)
    plt.legend()
    plt.show()


if __name__ == '__main__':
    plt.rcParams['font.sans-serif'] = ['FangSong']
    plt.rcParams['axes.unicode_minus'] = False
    file_path = 'data.xlsx'
    primary_industry_consumption, secondary_industry_consumption, tertiary_industry_consumption, inhabitant_consumption = read_structure_of_consumption(file_path)
    plot_structure_of_consumption(primary_industry_consumption, '第一产业能耗结构变化趋势')
    plot_structure_of_consumption(secondary_industry_consumption, '第二产业能耗结构变化趋势')
    plot_structure_of_consumption(tertiary_industry_consumption, '第三产业能耗结构变化趋势')
    plot_structure_of_consumption(inhabitant_consumption, '居民生活能耗结构变化趋势')
